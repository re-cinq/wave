{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Deterministic Pull Request Creation",
  "description": "Strict schema for PR creation with comprehensive validation",
  "type": "object",
  "required": ["title", "body", "head", "base", "changes_summary", "testing_done"],
  "properties": {
    "title": {
      "type": "string",
      "minLength": 10,
      "maxLength": 72,
      "pattern": "^(feat|fix|docs|style|refactor|test|chore)(\\(.+\\))?:\\s+.+",
      "description": "PR title following conventional commit format"
    },
    "body": {
      "type": "string",
      "minLength": 100,
      "description": "PR body with Summary, Changes, Testing, and Related Issues sections"
    },
    "head": {
      "type": "string",
      "minLength": 1,
      "pattern": "^(?!main$|master$).*$",
      "description": "Source branch (cannot be main/master)"
    },
    "base": {
      "type": "string",
      "minLength": 1,
      "description": "Target branch (usually main)"
    },
    "changes_summary": {
      "type": "object",
      "required": ["files_changed", "additions", "deletions"],
      "properties": {
        "files_changed": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of files modified"
        },
        "additions": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines added"
        },
        "deletions": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines removed"
        },
        "files_list": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of modified files"
        }
      }
    },
    "testing_done": {
      "type": "object",
      "required": ["tests_added", "tests_passed", "manual_testing"],
      "properties": {
        "tests_added": {
          "type": "boolean",
          "description": "Whether new tests were added"
        },
        "tests_passed": {
          "type": "boolean",
          "const": true,
          "description": "All tests must pass"
        },
        "manual_testing": {
          "type": "string",
          "minLength": 20,
          "description": "Description of manual testing performed"
        },
        "test_commands": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Commands to run tests"
        }
      }
    },
    "closes_issues": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "integer"
      },
      "description": "Issue numbers this PR closes"
    },
    "related_prs": {
      "type": "array",
      "items": {
        "type": "integer"
      },
      "description": "Related PR numbers"
    },
    "breaking_changes": {
      "type": "boolean",
      "description": "Whether this includes breaking changes"
    },
    "breaking_changes_description": {
      "type": "string",
      "description": "Required if breaking_changes is true"
    },
    "labels": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Suggested labels for the PR"
    },
    "reviewers": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Requested reviewers"
    },
    "draft": {
      "type": "boolean",
      "description": "Whether this is a draft PR"
    }
  }
}
