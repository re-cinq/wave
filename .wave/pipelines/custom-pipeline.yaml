kind: WavePipeline
metadata:
    name: fullstack-app-pipeline
    description: Build a complete full-stack application from requirements to deployment
input:
    source: meta
steps:
    - id: navigate
      persona: navigator
      memory:
        strategy: fresh
      workspace:
        root: ./
      exec:
        type: prompt
        source: 'Analyze the requirements for building a full-stack app: {{ input }}. Identify the tech stack, architecture patterns, key features, and implementation approach needed.'
      handover:
        contract:
            type: json_schema
            schema_path: .wave/contracts/analysis.schema.json
    - id: specify
      persona: philosopher
      dependencies:
        - navigate
      memory:
        strategy: fresh
        inject_artifacts:
            - step: navigate
              artifact: analysis
              as: context
      workspace:
        root: ./
      exec:
        type: prompt
        source: Create detailed specifications for the full-stack app based on the navigation analysis. Include data models, API design, user stories, and system architecture.
      handover:
        contract:
            type: json_schema
            schema_path: .wave/contracts/specification.schema.json
    - id: plan
      persona: philosopher
      dependencies:
        - specify
      memory:
        strategy: fresh
        inject_artifacts:
            - step: navigate
              artifact: analysis
              as: navigation_context
            - step: specify
              artifact: specification
              as: spec_context
      workspace:
        root: ./
      exec:
        type: prompt
        source: Break down the specification into ordered implementation tasks. Create a detailed implementation plan with dependencies, milestones, and deliverables.
      handover:
        contract:
            type: markdown
    - id: implement_backend
      persona: implementer
      dependencies:
        - plan
      memory:
        strategy: fresh
        inject_artifacts:
            - step: navigate
              artifact: analysis
              as: navigation_context
            - step: specify
              artifact: specification
              as: spec_context
            - step: plan
              artifact: plan
              as: implementation_plan
      workspace:
        root: ./
      exec:
        type: prompt
        source: Implement the backend components of the full-stack app according to the specification and plan. Focus on API endpoints, data models, and business logic.
      handover:
        contract:
            type: test_suite
            command: go test ./backend/... || npm test -- --testPathPattern=backend || python -m pytest backend/
    - id: implement_frontend
      persona: implementer
      dependencies:
        - implement_backend
      memory:
        strategy: fresh
        inject_artifacts:
            - step: navigate
              artifact: analysis
              as: navigation_context
            - step: specify
              artifact: specification
              as: spec_context
            - step: plan
              artifact: plan
              as: implementation_plan
            - step: implement_backend
              artifact: backend_code
              as: backend_context
      workspace:
        root: ./
      exec:
        type: prompt
        source: Implement the frontend components of the full-stack app. Create user interfaces, integrate with backend APIs, and implement user interactions.
      handover:
        contract:
            type: test_suite
            command: npm test -- --testPathPattern=frontend || yarn test frontend || npm run test:frontend
    - id: integrate
      persona: implementer
      dependencies:
        - implement_frontend
      memory:
        strategy: fresh
        inject_artifacts:
            - step: implement_backend
              artifact: backend_code
              as: backend_context
            - step: implement_frontend
              artifact: frontend_code
              as: frontend_context
      workspace:
        root: ./
      exec:
        type: prompt
        source: Integrate frontend and backend components. Set up API connections, handle data flow, and ensure proper communication between layers.
      handover:
        contract:
            type: test_suite
            command: npm run test:integration || go test ./integration/... || python -m pytest integration/
    - id: review
      persona: reviewer
      dependencies:
        - integrate
      memory:
        strategy: fresh
        inject_artifacts:
            - step: navigate
              artifact: analysis
              as: navigation_context
            - step: specify
              artifact: specification
              as: spec_context
            - step: implement_backend
              artifact: backend_code
              as: backend_context
            - step: implement_frontend
              artifact: frontend_code
              as: frontend_context
            - step: integrate
              artifact: integration_code
              as: integration_context
      workspace:
        root: ./
      exec:
        type: prompt
        source: Review the complete full-stack application for code quality, security, performance, and adherence to specifications. Identify any issues or improvements needed.
      handover:
        contract:
            type: json_schema
            schema_path: .wave/contracts/review.schema.json
