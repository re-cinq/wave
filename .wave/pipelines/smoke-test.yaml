kind: WavePipeline
metadata:
  name: smoke-test
  description: "Minimal pipeline for testing contracts and artifacts"
  release: false

input:
  source: cli
  example: "verify contract validation works"

steps:
  - id: analyze
    persona: navigator
    workspace:
      mount:
        - source: ./
          target: /project
          mode: readonly
    exec:
      type: prompt
      source: |
        Analyze the codebase for: {{ input }}

        Provide your analysis as structured JSON.
    output_artifacts:
      - name: analysis
        path: .wave/output/analysis.json
        type: json
    handover:
      contract:
        type: json_schema
        source: .wave/output/analysis.json
        schema_path: .wave/contracts/smoke-test.schema.json
        on_failure: retry
        max_retries: 2

  - id: summarize
    persona: summarizer
    dependencies: [analyze]
    memory:
      inject_artifacts:
        - step: analyze
          artifact: analysis
          as: analysis_data
    exec:
      type: prompt
      source: |
        Read the injected analysis artifact and write a brief markdown summary.

        Include:
        - What was analyzed
        - Key findings
        - Recommended next steps
    output_artifacts:
      - name: summary
        path: .wave/output/summary.md
        type: markdown
